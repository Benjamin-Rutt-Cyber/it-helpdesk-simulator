# Story 2.3: Customer Persona System

## Status

Fully Implemented

## Story

**As a** user developing customer service skills,  
**I want** to interact with different types of customers with distinct personalities,  
**so that** I can practice handling various customer situations and communication styles.

## Acceptance Criteria

1. **Persona Definitions:** 5 distinct customer personas implemented (Office Worker, Frustrated User, Patient Retiree, New Employee, Executive)
2. **Personality Traits:** Each persona has consistent communication style, technical knowledge level, and emotional responses
3. **Scenario Matching:** Appropriate persona automatically selected based on ticket type and context
4. **Behavioral Patterns:** Personas exhibit realistic behaviors like impatience, confusion, or appreciation based on user responses
5. **Technical Knowledge:** Personas display appropriate technical understanding for their role and background
6. **Emotional Progression:** Customer mood can improve or worsen based on user interaction quality
7. **Conversation Memory:** Personas remember previous interactions and reference them appropriately
8. **Cultural Sensitivity:** All personas designed to be inclusive and avoid stereotypes or bias

## Tasks / Subtasks

- [x] **Task 1: Define Core Customer Personas** (AC: 1, 2, 8)
  - [x] Create Office Worker persona with professional communication style
  - [x] Implement Frustrated User persona with impatient behavior patterns
  - [x] Add Patient Retiree persona with detailed explanations and courtesy
  - [x] Create New Employee persona with learning mindset and questions
  - [x] Implement Executive persona with time-sensitive, direct communication
  - [x] Ensure all personas are culturally sensitive and inclusive

- [x] **Task 2: Implement Personality Trait System** (AC: 2, 5)
  - [x] Create PersonalityTraits interface with communication patterns
  - [x] Implement technical knowledge levels (novice, intermediate, advanced)
  - [x] Add emotional response patterns for each persona
  - [x] Create vocabulary and language style mappings
  - [x] Implement patience levels and frustration thresholds

- [x] **Task 3: Build Persona Selection Engine** (AC: 3)
  - [x] Create persona matching algorithm based on ticket type
  - [x] Implement scenario context analysis for persona selection
  - [x] Add persona probability weighting system
  - [x] Create persona override capability for specific scenarios
  - [x] Implement persona selection logging and analytics

- [x] **Task 4: Implement Behavioral Pattern System** (AC: 4, 6)
  - [x] Create mood tracking and progression system
  - [x] Implement response-based mood adjustments
  - [x] Add behavioral triggers for persona-specific reactions
  - [x] Create escalation patterns for frustrated customers
  - [x] Implement appreciation and satisfaction responses

- [x] **Task 5: Add Technical Knowledge Management** (AC: 5)
  - [x] Create technical knowledge databases for each persona
  - [x] Implement appropriate technical vocabulary usage
  - [x] Add confusion patterns for complex technical explanations
  - [x] Create learning progression for personas during conversation
  - [x] Implement realistic technical misunderstandings

- [x] **Task 6: Create Conversation Memory System** (AC: 7)
  - [x] Implement persona-specific memory patterns
  - [x] Add conversation history referencing
  - [x] Create relationship building over multiple interactions
  - [x] Implement name and detail remembering
  - [x] Add continuity across session resumptions

- [x] **Task 7: Build Persona Management Service** (AC: 1-8)
  - [x] Create PersonaService for persona lifecycle management
  - [x] Implement PersonaState for dynamic personality tracking
  - [x] Add PersonaMemory for conversation continuity
  - [x] Create PersonaAnalytics for behavior tracking
  - [x] Implement PersonaValidator for response consistency

- [x] **Task 8: Write Persona System Tests** (AC: 1-8)
  - [x] Unit tests for persona trait consistency
  - [x] Integration tests for persona selection algorithms
  - [x] Behavioral pattern tests for mood progression
  - [x] Memory tests for conversation continuity
  - [x] Cultural sensitivity and bias detection tests

## Dev Notes

### Previous Story Insights

[Source: docs/stories/2.2.ai-integration-and-conversation-management.md] AI integration provides:

- OpenAI API integration with conversation context management
- Persona consistency enforcement through AI prompts
- Character trait maintenance throughout conversations
- Response generation with personality injection

[Source: docs/stories/2.1.real-time-chat-infrastructure.md] Chat infrastructure provides:

- Real-time message delivery for persona-based responses
- Message persistence for conversation memory
- Session management for persona state tracking
- Performance requirements for natural conversation flow

### Customer Persona Architecture

[Source: docs/architecture/data-models.md] Persona data structure:

- **CustomerPersona**: Name, personality traits, technical level, communication style
- **PersonalityTraits**: Patience level, formality, technical curiosity, emotional range
- **TechnicalLevel**: Novice, intermediate, advanced with specific knowledge areas
- **CommunicationStyle**: Direct, formal, casual, detailed, brief patterns

### Persona Definitions and Characteristics

Based on realistic customer service scenarios:

**Office Worker Persona:**

- **Communication**: Professional, direct, time-conscious
- **Technical Level**: Intermediate - familiar with basic IT concepts
- **Behavior**: Efficient, asks specific questions, appreciates quick solutions
- **Emotional Range**: Calm to mildly frustrated, appreciates competence

**Frustrated User Persona:**

- **Communication**: Impatient, emotional, may interrupt
- **Technical Level**: Novice - limited technical understanding
- **Behavior**: Repeats problems, expresses frustration, needs reassurance
- **Emotional Range**: Annoyed to angry, can be calmed with good service

**Patient Retiree Persona:**

- **Communication**: Polite, detailed, asks for clarification
- **Technical Level**: Novice - requires step-by-step guidance
- **Behavior**: Courteous, methodical, grateful for help
- **Emotional Range**: Pleasant to appreciative, rarely frustrated

**New Employee Persona:**

- **Communication**: Uncertain, learning-oriented, apologetic
- **Technical Level**: Novice to intermediate - eager to learn
- **Behavior**: Asks many questions, follows instructions carefully
- **Emotional Range**: Nervous to grateful, builds confidence

**Executive Persona:**

- **Communication**: Authoritative, brief, results-focused
- **Technical Level**: Intermediate - understands business impact
- **Behavior**: Delegates, focuses on business impact, time-sensitive
- **Emotional Range**: Neutral to impatient, appreciates efficiency

### Backend Persona Service Structure

[Source: docs/architecture/backend-architecture.md] Persona service organization:

- **PersonaService**: apps/api/src/services/personaService.ts - Main persona management
- **PersonaSelector**: Persona matching and selection algorithms
- **PersonaState**: Dynamic personality and mood tracking
- **PersonaMemory**: Conversation history and relationship building
- **PersonaAnalytics**: Behavior tracking and improvement metrics

### Technology Stack for Persona System

[Source: docs/architecture/tech-stack.md] Persona technology requirements:

- **AI Integration**: OpenAI API for persona-consistent responses
- **State Management**: Redis for persona state and memory persistence
- **Database**: PostgreSQL for persona definitions and analytics
- **Analytics**: Performance tracking for persona effectiveness
- **Testing**: Jest for persona behavior validation

### Persona Selection Algorithm

Based on scenario context and ticket analysis:

- **Ticket Type Analysis**: Hardware, software, network, security categories
- **Complexity Assessment**: Technical difficulty and urgency evaluation
- **Context Matching**: Scenario requirements and learning objectives
- **Persona Weighting**: Probability distribution for realistic variety
- **Override Capability**: Manual persona selection for specific training

### Behavioral Pattern Implementation

[Source: docs/architecture/components.md] Persona behavior patterns:

- **Mood Tracking**: Numerical mood scale with progression rules
- **Response Triggers**: Specific phrases or actions that affect mood
- **Escalation Patterns**: Frustration building and resolution paths
- **Appreciation Responses**: Positive reinforcement for good service
- **Memory Integration**: Reference to previous interactions and solutions

### File Locations

Based on backend architecture and persona service structure:

- `apps/api/src/services/personaService.ts` - Main persona management
- `apps/api/src/services/personaSelector.ts` - Persona matching algorithms
- `apps/api/src/models/PersonaState.ts` - Dynamic persona tracking
- `apps/api/src/models/PersonaMemory.ts` - Conversation memory
- `apps/api/src/utils/personaPrompts.ts` - Persona-specific AI prompts
- `apps/api/src/config/personas.ts` - Persona definitions and traits
- `apps/api/src/analytics/personaAnalytics.ts` - Persona effectiveness tracking

### Integration with AI Service

[Source: docs/architecture/components.md] Persona-AI integration:

- **Prompt Engineering**: Persona-specific system prompts and context
- **Response Filtering**: Persona consistency validation
- **Mood Injection**: Dynamic mood state in AI responses
- **Memory Integration**: Previous interaction context in AI prompts
- **Behavioral Enforcement**: Persona trait adherence in responses

### Cultural Sensitivity and Bias Prevention

[Source: docs/architecture/backend-architecture.md] Inclusive design requirements:

- **Diversity**: Personas represent diverse backgrounds without stereotypes
- **Neutral Characteristics**: Avoid gender, racial, or cultural bias
- **Professional Focus**: Emphasize work-related traits over personal characteristics
- **Accessibility**: Consider different communication needs and preferences
- **Validation**: Regular bias testing and persona refinement

### Performance and Analytics

Persona system must track:

- **Effectiveness Metrics**: User learning outcomes by persona type
- **Engagement Tracking**: Conversation length and quality by persona
- **Mood Progression**: Emotional journey tracking for training effectiveness
- **Memory Accuracy**: Conversation continuity and relationship building
- **Selection Accuracy**: Persona-scenario matching effectiveness

### Testing Requirements

[Source: docs/architecture/tech-stack.md] Persona testing approach:

- **Consistency Tests**: Persona trait adherence across conversations
- **Behavioral Tests**: Mood progression and response patterns
- **Memory Tests**: Conversation continuity and relationship building
- **Selection Tests**: Appropriate persona matching for scenarios
- **Bias Tests**: Cultural sensitivity and inclusivity validation

### Project Structure Notes

The persona system provides the psychological foundation for realistic customer interactions. It must deliver consistent, believable, and diverse customer experiences while maintaining cultural sensitivity and supporting effective learning outcomes. The system should create authentic customer service training scenarios that prepare users for real-world interactions.

## Change Log

| Date       | Version | Description                                 | Author             |
| ---------- | ------- | ------------------------------------------- | ------------------ |
| 2025-07-17 | 1.0     | Initial story creation using formal process | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

- Successfully implemented 5 distinct customer personas with comprehensive personality systems
- Advanced persona selection engine with multi-factor scoring algorithm
- Redis-based persona state and memory management systems
- Comprehensive behavioral pattern tracking and mood progression
- Cultural sensitivity validation and bias prevention measures implemented
- Full integration with existing AI service for persona-consistent responses

### Completion Notes List

- ✅ Five distinct customer personas: Office Worker, Frustrated User, Patient Retiree, New Employee, Executive
- ✅ Comprehensive personality trait system with communication patterns, technical levels, emotional responses
- ✅ Advanced persona selection engine with context analysis and weighting algorithms
- ✅ Dynamic behavioral pattern system with mood tracking and escalation patterns
- ✅ Technical knowledge management with vocabulary mapping and learning progression
- ✅ Sophisticated conversation memory system with relationship building and continuity
- ✅ Complete persona management service with state tracking and analytics
- ✅ Extensive test coverage including cultural sensitivity and bias detection
- ✅ Integration with AI service through persona-specific prompt generation
- ✅ Redis-based persistence for persona state and memory across sessions

### File List

**Core Persona System:**

- `apps/api/src/config/personas.ts` - Complete persona definitions with 5 detailed customer archetypes
- `apps/api/src/models/PersonaState.ts` - Dynamic persona state management with mood tracking
- `apps/api/src/models/PersonaMemory.ts` - Conversation memory and relationship building system
- `apps/api/src/services/personaSelector.ts` - Advanced persona selection engine with multi-factor scoring
- `apps/api/src/services/personaService.ts` - Main persona management service with session lifecycle
- `apps/api/src/utils/personaPrompts.ts` - AI integration with persona-specific prompt generation

**Testing:**

- `apps/api/src/__tests__/services/personaService.test.ts` - Comprehensive persona service unit tests
- `apps/api/src/__tests__/services/personaSelector.test.ts` - Persona selection algorithm validation tests

**Key Features Implemented:**

- **5 Distinct Personas**: Office Worker (professional), Frustrated User (impatient), Patient Retiree (courteous), New Employee (learning-oriented), Executive (time-sensitive)
- **Dynamic State Management**: Real-time mood tracking, satisfaction levels, escalation risk assessment
- **Memory System**: Cross-session persona memory with relationship building and conversation continuity
- **Selection Intelligence**: Context-aware persona matching based on ticket type, complexity, learning objectives
- **Cultural Sensitivity**: Bias-free persona design focused on professional traits and behavioral patterns
- **AI Integration**: Persona-specific prompt generation for consistent character portrayal
- **Analytics**: Comprehensive persona effectiveness tracking and learning outcome measurement

## QA Results

_This section will be populated by the QA engineer during review_
